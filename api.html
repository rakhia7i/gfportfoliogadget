<html>
	<head>
		<title>JavaScript Test Page</title>
		<script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript" language="JavaScript">
			google.load("gdata", "2", {packages: ["finance"]});
		</script>
	</head>
	<body>
		<img src="http://localhost/~mferrare/gfportfoliogadget/pic.jpg" width=10 height=10 alt="pic">
		<form name="inputform">
		<input type=button name="login" value="Login" onclick="logMeIn()">
		<input type=button name="logout" value="Logout" onclick="logMeOut()">
		<input type=button name="cleardebug" value="Clear Debug Window" onclick="clearDebug()">
		<input type=button name="getmyfeed" value="Get My Feed" onclick="getMyFeed()">
		<input type=text name="ready" value="0">
		<input type=text name="loggedin" value="">
		</form>
		<div id="debugdiv">Debug Output</div>
		<script type="text/javascript" language="JavaScript">

			google.setOnLoadCallback(setReady);
			var feedUrl = "http://www.google.com/finance/feeds/markjfe@gmail.com/private/full"
			var ready = 0

			function setReady() {
				document.forms["inputform"]["ready"].value = 1;
				document.forms["inputform"]["loggedin"].value = "not sure: " + google.accounts.user.getInfo();

			}

			function getReady() {
				return document.forms["inputform"]["ready"].value;
			}

			function logMeIn() {
				scope = "http://www.google.com/finance/feeds/";
				var token = google.accounts.user.login(scope);
				document.forms["inputform"]["loggedin"].value = "logged in: " + google.accounts.user.login.getInfo();
			}

			function logMeOut() {
				google.accounts.user.logout();
				document.forms["inputform"]["loggedin"].value = "logged out: " + google.accounts.user.login.getInfo();
			}

			function setupMyService() {
				var myService = new google.gdata.finance.FinanceService('exampleCo-exampleApp-1');
				return myService;
			}

			function getMyFeed() {
				if ( getReady() == 1 ) {
					myService = setupMyService();
					myService.getEventsFeed(feedUrl, handleMyFeed, handleError);
				} else {
					debug("not ready: " + getReady());
				}
			}

			function handleMyFeed(myResultsFeedRoot) {
			  msg = "This feed's title is: " + myResultsFeedRoot.feed.getTitle().getText();
			  debug(msg);
			}

			function debug(msg) {
			  b = document.createElement("p");
			  b.appendChild(document.createTextNode(msg))
			  debugdiv = document.getElementById("debugdiv");
			  debugdiv.appendChild(b);
			}

			function clearDebug() {
				document.getElementById("debugdiv").innerHTML = "";
			}

			function handleError(e) {
			  debug("There was an error!  You may need to logout and login again");
			  debug(e.cause ? e.cause.statusText : e.message);
			}

		</script>